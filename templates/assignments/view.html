{% extends "base.html" %} {% block content %}
<style>
  .method {
    background: #f5f5f5;
    padding: 20px;
    margin: 20px 0;
    border-radius: 8px;
    border-left: 4px solid #007acc;
  }

  .example {
    background: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 4px;
    border: 1px solid #ddd;
  }

  .code {
    background: #2d3748;
    color: #e2e8f0;
    padding: 10px;
    border-radius: 4px;
    font-family: "Courier New", monospace;
    margin: 10px 0;
    overflow-x: auto;
  }

  .fraction-unicode {
    font-size: 1.2em;
  }

  .fraction-sup-sub {
    display: inline-block;
  }

  .fraction-sup-sub sup {
    line-height: 0;
  }

  .fraction-sup-sub sub {
    line-height: 0;
  }

  .fraction-css {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    vertical-align: middle;
    font-size: 0.9em;
    margin: 0 3px;
  }

  .fraction-css .numerator {
    border-bottom: 1px solid black;
    padding-bottom: 2px;
    text-align: center;
    min-width: 20px;
  }

  .fraction-css .denominator {
    padding-top: 2px;
    text-align: center;
    min-width: 20px;
  }

  .fraction-svg {
    vertical-align: middle;
  }

  .math-display {
    font-size: 1.2em;
    margin: 10px 0;
  }

  h1 {
    color: #2d3748;
    text-align: center;
    margin-bottom: 30px;
  }

  h2 {
    color: #4a5568;
    border-bottom: 2px solid #e2e8f0;
    padding-bottom: 5px;
  }

  .comparison {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 20px 0;
  }

  .comparison-item {
    text-align: center;
    padding: 15px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 4px;
  }

  .fraction-large {
    font-size: 2em;
    margin: 10px 0;
  }

  /* Enhanced styles for interactive questions */
  .interactive-assignment {
    margin-top: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
  }

  .question {
    background: #ffffff;
    border: 1px solid #dee2e6;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .question:hover {
    background: #f8f9fa;
    border-color: #007acc;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  .question-text {
    font-size: 1.1em;
    line-height: 1.6;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 4px;
    border: 1px solid #e9ecef;
    margin-bottom: 15px;
  }

  .options-container,
  .answer-container,
  .true-false-container {
    margin-top: 15px;
    padding: 15px;
    background: #ffffff;
    border-radius: 4px;
    border: 1px solid #e9ecef;
  }

  .form-check {
    margin-bottom: 12px;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 4px;
    transition: background-color 0.2s ease;
  }

  .form-check:hover {
    background: #e9ecef;
  }

  .form-check-label {
    font-size: 1em;
    margin-left: 8px;
    cursor: pointer;
  }

  .form-control {
    border: 2px solid #dee2e6;
    border-radius: 6px;
    padding: 10px;
    font-size: 1em;
    transition: border-color 0.2s ease;
  }

  .form-control:focus {
    border-color: #007acc;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 204, 0.25);
  }

  .question-number {
    background: #007acc;
    color: white;
    padding: 4px 8px;
    border-radius: 15px;
    font-size: 0.9em;
    font-weight: bold;
  }

  .marks-badge {
    background: #28a745;
    color: white;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.8em;
    float: right;
  }
</style>

<div class="container mt-4">
  <h2>{{ assignment[1] }}</h2>
  <div class="row mb-3">
    <div class="col-md-6">
      <span class="badge bg-primary">{{ assignment[3] }}</span>
      <span class="badge bg-secondary">{{ assignment[4] }}</span>
    </div>
    <div class="col-md-6 text-end">
      <span class="text-muted"
        >Due: {{ assignment.deadline.strftime('%Y-%m-%d %H:%M') }}</span
      >
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">Assignment Details</h5>
      <div class="card-text">{{ assignment[2]|safe }}</div>
      <hr />
      <p><strong>Total Marks:</strong> {{ assignment[5] }}</p>
    </div>
  </div>

  {% if assignment[7] %}
  <!-- Check if there's interactive content -->
  <div class="card mb-4">
    <div class="card-body">{{ assignment[7]|safe }}</div>
  </div>
  {% endif %} {% if assignment.content and assignment.content.questions %}
  <div class="interactive-assignment">
    <h3><i class="fas fa-calculator"></i> Interactive Questions</h3>
    <p class="text-muted mb-4">
      Answer each question below. Use proper fraction notation where applicable.
    </p>

    <form method="POST" enctype="multipart/form-data">
      {% for question in assignment.content.questions %}
      <div class="question mb-4 p-3 border rounded">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="question-number">Question {{ loop.index }}</span>
          <span class="marks-badge">{{ question.marks }} marks</span>
        </div>
        <div class="question-text">{{ question.question|safe }}</div>

        {% if question.type == 'multiple_choice' %}
        <div class="options-container">
          <h6 class="text-muted mb-3">Select the correct answer:</h6>
          {% for option in question.options %}
          <div class="form-check">
            <input class="form-check-input" type="radio" name="q_{{ question.id
            }}" id="q{{ question.id }}_{{ loop.index }}" value="{{ option }}" {%
            if submission and submission.interactive_submission_data and option
            == submission.interactive_submission_data[question.id|string].answer
            %} checked {% endif %}>
            <label
              class="form-check-label"
              for="q{{ question.id }}_{{ loop.index }}"
            >
              {{ option|safe }}
            </label>
          </div>
          {% endfor %}
        </div>

        {% elif question.type == 'short_answer' %}
        <div class="answer-container">
          <h6 class="text-muted mb-3">Enter your answer:</h6>
          <textarea
            class="form-control"
            name="q_{{ question.id }}"
            rows="3"
            placeholder="Enter your answer here using proper fraction notation..."
          >
{% if submission and submission.interactive_submission_data %}{{ submission.interactive_submission_data[question.id|string].answer }}{% endif %}</textarea
          >
        </div>

        {% elif question.type == 'true_false' %}
        <div class="true-false-container">
          <h6 class="text-muted mb-3">Select True or False:</h6>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="q_{{ question.id
            }}" id="q{{ question.id }}_true" value="true" {% if submission and
            submission.interactive_submission_data and
            submission.interactive_submission_data[question.id|string].answer ==
            'true' %} checked {% endif %}>
            <label class="form-check-label" for="q{{ question.id }}_true">
              <strong>True</strong>
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="q_{{ question.id
            }}" id="q{{ question.id }}_false" value="false" {% if submission and
            submission.interactive_submission_data and
            submission.interactive_submission_data[question.id|string].answer ==
            'false' %} checked {% endif %}>
            <label class="form-check-label" for="q{{ question.id }}_false">
              <strong>False</strong>
            </label>
          </div>
        </div>

        {% elif question.type == 'problem_solving' %}
        <div class="answer-container">
          <h6 class="text-muted mb-3">
            Show your work and provide the final answer:
          </h6>
          <textarea
            class="form-control"
            name="q_{{ question.id }}"
            rows="5"
            placeholder="Show your work step by step and provide the final answer..."
          >
{% if submission and submission.interactive_submission_data %}{{ submission.interactive_submission_data[question.id|string].answer }}{% endif %}</textarea
          >
        </div>
        {% endif %}
      </div>
      {% endfor %}

      <div class="card mt-4">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-comment"></i> Additional Comments
          </h5>
        </div>
        <div class="card-body">
          <div class="form-group mb-3">
            <label for="submission_text" class="form-label"
              >Additional Comments (Optional)</label
            >
            <textarea
              class="form-control"
              id="submission_text"
              name="submission_text"
              rows="3"
              placeholder="Add any additional comments or explanations here..."
            >
{% if submission %}{{ submission.submission_text }}{% endif %}</textarea
            >
          </div>

          <div class="form-group mb-3">
            <label for="assignment_file" class="form-label"
              >Upload Supporting File (Optional)</label
            >
            <input
              type="file"
              class="form-control"
              id="assignment_file"
              name="assignment_file"
              accept=".pdf,.docx,.doc,.jpg,.jpeg,.png"
            />
            <div class="form-text">
              Accepted formats: PDF, DOCX, DOC, JPG, PNG (max 5MB)
            </div>
            {% if submission and submission.file_path %}
            <small class="form-text text-success">
              <i class="fas fa-file"></i> Previously uploaded:
              <a
                href="{{ url_for('static', filename='uploads/' + submission.file_path.split('/')[-1]) }}"
                target="_blank"
                class="text-decoration-none"
              >
                {{ submission.file_path.split('/')[-1] }}
              </a>
            </small>
            {% endif %}
          </div>

          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="fas fa-paper-plane"></i> Submit Assignment
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>

  {% else %}
  <!-- Fallback for non-interactive assignments -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Submit Your Work</h5>
    </div>
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="submission_text" class="form-label">Your Answers</label>
          <textarea
            class="form-control"
            id="submission_text"
            name="submission_text"
            rows="10"
            placeholder="Enter your solutions here..."
            required
          >
{% if submission %}{{ submission.submission_text }}{% endif %}</textarea
          >
        </div>

        <div class="mb-3">
          <label for="assignment_file" class="form-label"
            >Supporting Files (Optional)</label
          >
          <input
            class="form-control"
            type="file"
            id="assignment_file"
            name="assignment_file"
          />
          <div class="form-text">PDF, DOCX, or image files (max 5MB)</div>
          {% if submission and submission.file_path %}
          <small class="form-text text-muted">
            Previously uploaded:
            <a
              href="{{ url_for('static', filename='uploads/' + submission.file_path.split('/')[-1]) }}"
              target="_blank"
            >
              {{ submission.file_path.split('/')[-1] }}
            </a>
          </small>
          {% endif %}
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <button type="submit" class="btn btn-primary">
            Submit Assignment
          </button>
        </div>
      </form>
    </div>
  </div>
  {% endif %}
</div>

{% if assignment[7] %}
<script>
  function validateListExercises() {
    // This function would validate the interactive exercises
    // You would need to implement the actual validation logic
    alert("Validation would happen here in a real implementation");
  }

  // Add some interactivity for better UX
  document.addEventListener("DOMContentLoaded", function () {
    // Highlight selected radio buttons
    const radioButtons = document.querySelectorAll('input[type="radio"]');
    radioButtons.forEach((radio) => {
      radio.addEventListener("change", function () {
        // Remove highlight from siblings
        const siblings = document.querySelectorAll(
          `input[name="${this.name}"]`
        );
        siblings.forEach((sibling) => {
          sibling.closest(".form-check").style.background = "#f8f9fa";
        });
        // Highlight selected
        this.closest(".form-check").style.background = "#e3f2fd";
      });
    });

    // Auto-resize textareas
    const textareas = document.querySelectorAll("textarea");
    textareas.forEach((textarea) => {
      textarea.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
      });
    });
  });
</script>
{% endif %} {% endblock %}
