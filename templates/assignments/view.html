{% extends "base.html" %} {% block content %}
<div class="container mt-4">
  <h2>{{ assignment[1] }}</h2>
  <div class="row mb-3">
    <div class="col-md-6">
      <span class="badge bg-primary">{{ assignment[3] }}</span>
      <span class="badge bg-secondary">{{ assignment[4] }}</span>
    </div>
    <div class="col-md-6 text-end">
      <span class="text-muted"
        >Due: {{ assignment[6].strftime('%Y-%m-%d %H:%M') }}</span
      >
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">Assignment Details</h5>
      <div class="card-text">{{ assignment[2]|safe }}</div>
      <hr />
      <p><strong>Total Marks:</strong> {{ assignment[5] }}</p>
    </div>
  </div>

  {% if assignment[7] %}
  <!-- Check if there's interactive content -->
  <div class="card mb-4">
    <div class="card-body">{{ assignment[7]|safe }}</div>
  </div>
  {% endif %}

  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Submit Your Work</h5>
    </div>
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="submission_text" class="form-label">Your Answers</label>
          <textarea
            class="form-control"
            id="submission_text"
            name="submission_text"
            rows="10"
            required
          ></textarea>
        </div>

        <div class="mb-3">
          <label for="assignment_file" class="form-label"
            >Supporting Files (Optional)</label
          >
          <input
            class="form-control"
            type="file"
            id="assignment_file"
            name="assignment_file"
          />
          <div class="form-text">PDF, DOCX, or image files (max 5MB)</div>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <button type="submit" class="btn btn-primary">
            Submit Assignment
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Add this to your existing template -->
{% if assignment.content and assignment.content.questions %}
<div class="interactive-assignment">
  <h3>Interactive Questions</h3>
  <form method="POST" enctype="multipart/form-data">
    {% for question in assignment.content.questions %}
    <div class="question mb-4">
      <p><strong>Question {{ loop.index }}:</strong> {{ question.question }}</p>

      {% if question.type == 'multiple_choice' %} {% for option in
      question.options %}
      <div class="form-check">
        <input class="form-check-input" type="radio" name="q_{{ question.id }}"
        id="q{{ question.id }}_{{ loop.index }}" value="{{ option }}" {% if
        submission and submission.interactive_submission_data and option ==
        submission.interactive_submission_data[question.id|string].answer %}
        checked {% endif %}>
        <label
          class="form-check-label"
          for="q{{ question.id }}_{{ loop.index }}"
        >
          {{ option }}
        </label>
      </div>
      {% endfor %} {% elif question.type == 'short_answer' %}
      <textarea class="form-control" name="q_{{ question.id }}" rows="2">
{% if submission and submission.interactive_submission_data %}{{ submission.interactive_submission_data[question.id|string].answer }}{% endif %}</textarea
      >

      {% elif question.type == 'true_false' %}
      <div class="form-check">
        <input class="form-check-input" type="radio" name="q_{{ question.id }}"
        id="q{{ question.id }}_true" value="True" {% if submission and
        submission.interactive_submission_data and
        submission.interactive_submission_data[question.id|string].answer ==
        'True' %} checked {% endif %}>
        <label class="form-check-label" for="q{{ question.id }}_true">
          True
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="q_{{ question.id }}"
        id="q{{ question.id }}_false" value="False" {% if submission and
        submission.interactive_submission_data and
        submission.interactive_submission_data[question.id|string].answer ==
        'False' %} checked {% endif %}>
        <label class="form-check-label" for="q{{ question.id }}_false">
          False
        </label>
      </div>
      {% endif %}
    </div>
    {% endfor %}

    <!-- Existing submission fields -->
    <div class="form-group">
      <label for="submission_text">Additional Comments</label>
      <textarea
        class="form-control"
        id="submission_text"
        name="submission_text"
        rows="3"
      >
                {% if submission %}{{ submission.submission_text }}{% endif %}
            </textarea
      >
    </div>

    <div class="form-group">
      <label for="assignment_file">Upload File (optional)</label>
      <input
        type="file"
        class="form-control-file"
        id="assignment_file"
        name="assignment_file"
      />
      {% if submission and submission.file_path %}
      <small class="form-text text-muted">
        Previously uploaded:
        <a
          href="{{ url_for('static', filename='uploads/' + submission.file_path.split('/')[-1]) }}"
          target="_blank"
        >
          {{ submission.file_path.split('/')[-1] }}
        </a>
      </small>
      {% endif %}
    </div>

    <button type="submit" class="btn btn-primary">Submit Assignment</button>
  </form>
</div>
{% else %}
<!-- Existing non-interactive assignment form -->
<form method="POST" enctype="multipart/form-data">
  <div class="form-group">
    <label for="submission_text">Your Submission</label>
    <textarea
      class="form-control"
      id="submission_text"
      name="submission_text"
      rows="5"
    >
            {% if submission %}{{ submission.submission_text }}{% endif %}
        </textarea
    >
  </div>

  <div class="form-group">
    <label for="assignment_file">Upload File (optional)</label>
    <input
      type="file"
      class="form-control-file"
      id="assignment_file"
      name="assignment_file"
    />
    {% if submission and submission.file_path %}
    <small class="form-text text-muted">
      Previously uploaded:
      <a
        href="{{ url_for('static', filename='uploads/' + submission.file_path.split('/')[-1]) }}"
        target="_blank"
      >
        {{ submission.file_path.split('/')[-1] }}
      </a>
    </small>
    {% endif %}
  </div>

  <button type="submit" class="btn btn-primary">Submit Assignment</button>
</form>
{% endif %} {% if assignment[7] %}
<script>
  function validateListExercises() {
    // This function would validate the interactive exercises
    // You would need to implement the actual validation logic
    alert("Validation would happen here in a real implementation");
  }
</script>
{% endif %} {% endblock %}
