{% extends "base.html" %}
{% block title %}{{ exam.title }}{% endblock %}
{% block content %}
<head>
  <meta name="exam-title" content="Grade 7 Maths Exam Functions and Relationships" />
  <meta name="exam-grade" content="7" />
  <meta name="exam-subject" content="Mathematics" />
  <meta
    name="exam-description"
    content="Comprehensive exam on functions, relationships, and mathematical patterns for Grade 7 Mathematics."
  />
  <meta name="exam-duration" content="45" />
  <meta name="exam-difficulty" content="Medium" />
  <style>
    .correct .form-check-label {
      color: #198754; /* Bootstrap success green */
      font-weight: bold;
    }
    .incorrect .form-check-label {
      color: #dc3545; /* Bootstrap danger red */
      text-decoration: line-through;
    }
    .correct-answer .form-check-label {
        color: #198754;
        font-weight: bold;
    }
    .feedback {
        font-size: 0.9em;
        font-weight: bold;
    }
    .correct-feedback {
        color: #198754;
    }
    .incorrect-feedback {
        color: #dc3545;
    }
  </style>
</head>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">{{ exam.title }}</h1>
    <div id="timer" class="fw-bold fs-4 text-danger"></div>
  </div>
  <p>{{ exam.description }}</p>
  <form
    action="{{ url_for('exam.submit_exam', exam_id=exam.id) }}"
    method="post"
    id="exam-form"
  >
    <div id="questions-container">
      <!-- Section 1: Basic Patterns and Formulas -->
      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            1. In a sequence, Arrangement 1 has 6 red squares. If red squares increase by 4 each time, how many are in Arrangement 5?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_1"
              id="q1_option1"
              value="18"
            />
            <label class="form-check-label" for="q1_option1">18</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_1"
              id="q1_option2"
              value="20"
            />
            <label class="form-check-label" for="q1_option2">20</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_1"
              id="q1_option3"
              value="22"
              correct="true"
            />
            <label class="form-check-label" for="q1_option3">22</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            2. For black squares following 3, 6, 11, 18, what's the next term?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_2"
              id="q2_option1"
              value="25"
            />
            <label class="form-check-label" for="q2_option1">25</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_2"
              id="q2_option2"
              value="27"
              correct="true"
            />
            <label class="form-check-label" for="q2_option2">27</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_2"
              id="q2_option3"
              value="29"
            />
            <label class="form-check-label" for="q2_option3">29</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            3. Which formula represents red squares increasing by 4 per arrangement?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_3"
              id="q3_option1"
              value="y = 2x + 4"
            />
            <label class="form-check-label" for="q3_option1">y = 2x + 4</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_3"
              id="q3_option2"
              value="y = 4x + 2"
              correct="true"
            />
            <label class="form-check-label" for="q3_option2">y = 4x + 2</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_3"
              id="q3_option3"
              value="y = x² + 4"
            />
            <label class="form-check-label" for="q3_option3">y = x² + 4</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            4. If z = x² + 2, how many black squares in Arrangement 4?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_4"
              id="q4_option1"
              value="16"
            />
            <label class="form-check-label" for="q4_option1">16</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_4"
              id="q4_option2"
              value="18"
              correct="true"
            />
            <label class="form-check-label" for="q4_option2">18</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_4"
              id="q4_option3"
              value="20"
            />
            <label class="form-check-label" for="q4_option3">20</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            5. For y = 3x - 1, find y when x = 3
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_5"
              id="q5_option1"
              value="6"
            />
            <label class="form-check-label" for="q5_option1">6</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_5"
              id="q5_option2"
              value="8"
              correct="true"
            />
            <label class="form-check-label" for="q5_option2">8</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_5"
              id="q5_option3"
              value="10"
            />
            <label class="form-check-label" for="q5_option3">10</label>
          </div>
        </div>
      </div>

      <!-- Section 2: Formula Applications -->
      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            6. What does m represent in m = 60 × h?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_6"
              id="q6_option1"
              value="Hours"
            />
            <label class="form-check-label" for="q6_option1">Hours</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_6"
              id="q6_option2"
              value="Minutes"
              correct="true"
            />
            <label class="form-check-label" for="q6_option2">Minutes</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_6"
              id="q6_option3"
              value="Seconds"
            />
            <label class="form-check-label" for="q6_option3">Seconds</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            7. Calculate minutes in 4.5 hours using m = 60 × h
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_7"
              id="q7_option1"
              value="240"
            />
            <label class="form-check-label" for="q7_option1">240</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_7"
              id="q7_option2"
              value="270"
              correct="true"
            />
            <label class="form-check-label" for="q7_option2">270</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_7"
              id="q7_option3"
              value="300"
            />
            <label class="form-check-label" for="q7_option3">300</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            8. A bus company charges R300 per trip plus R2 per km. Write the formula for the fare (F) in terms of distance (d).
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_8"
              id="q8_option1"
              value="F = 300d + 2"
            />
            <label class="form-check-label" for="q8_option1">F = 300d + 2</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_8"
              id="q8_option2"
              value="F = 2d + 300"
              correct="true"
            />
            <label class="form-check-label" for="q8_option2">F = 2d + 300</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_8"
              id="q8_option3"
              value="F = 2 + 300d"
            />
            <label class="form-check-label" for="q8_option3">F = 2 + 300d</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            9. If y = 5x + 3, find y when x = 4
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_9"
              id="q9_option1"
              value="20"
            />
            <label class="form-check-label" for="q9_option1">20</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_9"
              id="q9_option2"
              value="23"
              correct="true"
            />
            <label class="form-check-label" for="q9_option2">23</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_9"
              id="q9_option3"
              value="26"
            />
            <label class="form-check-label" for="q9_option3">26</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            10. Which formula matches this table?
            <table class="table table-bordered">
              <tr>
                <th>x</th>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>4</td>
              </tr>
              <tr>
                <th>y</th>
                <td>7</td>
                <td>10</td>
                <td>13</td>
                <td>16</td>
              </tr>
            </table>
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_10"
              id="q10_option1"
              value="y = 4x + 3"
            />
            <label class="form-check-label" for="q10_option1">y = 4x + 3</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_10"
              id="q10_option2"
              value="y = 3x + 4"
              correct="true"
            />
            <label class="form-check-label" for="q10_option2">y = 3x + 4</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_10"
              id="q10_option3"
              value="y = 2x + 5"
            />
            <label class="form-check-label" for="q10_option3">y = 2x + 5</label>
          </div>
        </div>
      </div>

      <!-- Section 3: Real-World Applications -->
      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            11. Hamba Kahle Tours charges R500 per trip plus R0.50 per km. Calculate the fare for a 250 km trip.
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_11"
              id="q11_option1"
              value="600"
            />
            <label class="form-check-label" for="q11_option1">600</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_11"
              id="q11_option2"
              value="625"
              correct="true"
            />
            <label class="form-check-label" for="q11_option2">625</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_11"
              id="q11_option3"
              value="650"
            />
            <label class="form-check-label" for="q11_option3">650</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            12. If Saamgaan Tours charges R450 plus R0.60 per km, how much cheaper is it than Hamba Kahle for a 200 km trip?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_12"
              id="q12_option1"
              value="20"
            />
            <label class="form-check-label" for="q12_option1">20</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_12"
              id="q12_option2"
              value="30"
              correct="true"
            />
            <label class="form-check-label" for="q12_option2">30</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_12"
              id="q12_option3"
              value="40"
            />
            <label class="form-check-label" for="q12_option3">40</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            13. For the formula y = 30x + 1, calculate y when x = 0.2
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_13"
              id="q13_option1"
              value="6"
            />
            <label class="form-check-label" for="q13_option1">6</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_13"
              id="q13_option2"
              value="7"
              correct="true"
            />
            <label class="form-check-label" for="q13_option2">7</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_13"
              id="q13_option3"
              value="8"
            />
            <label class="form-check-label" for="q13_option3">8</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            14. Red squares follow y = 5x - 2. How many in Arrangement 10?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_14"
              id="q14_option1"
              value="45"
            />
            <label class="form-check-label" for="q14_option1">45</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_14"
              id="q14_option2"
              value="48"
              correct="true"
            />
            <label class="form-check-label" for="q14_option2">48</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_14"
              id="q14_option3"
              value="50"
            />
            <label class="form-check-label" for="q14_option3">50</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            15. Solve F = 0.55d + 480 for F=700 (nearest km)
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_15"
              id="q15_option1"
              value="350"
            />
            <label class="form-check-label" for="q15_option1">350</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_15"
              id="q15_option2"
              value="400"
              correct="true"
            />
            <label class="form-check-label" for="q15_option2">400</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_15"
              id="q15_option3"
              value="450"
            />
            <label class="form-check-label" for="q15_option3">450</label>
          </div>
        </div>
      </div>

      <!-- Section 4: Advanced Concepts -->
      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            16. Which represents "subtract 3 from the input and then multiply by 4"?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_16"
              id="q16_option1"
              value="y = 4(x - 3)"
              correct="true"
            />
            <label class="form-check-label" for="q16_option1">y = 4(x - 3)</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_16"
              id="q16_option2"
              value="y = 4x - 3"
            />
            <label class="form-check-label" for="q16_option2">y = 4x - 3</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_16"
              id="q16_option3"
              value="y = 3x - 4"
            />
            <label class="form-check-label" for="q16_option3">y = 3x - 4</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            17. Complete the table for y = 2x² + 1:
            <table class="table table-bordered">
              <tr>
                <th>x</th>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>4</td>
              </tr>
              <tr>
                <th>y</th>
                <td>
                  <input type="number" class="form-control" name="q17_1" data-answer="3">
                </td>
                <td>
                  <input type="number" class="form-control" name="q17_2" data-answer="9">
                </td>
                <td>
                  <input type="number" class="form-control" name="q17_3" data-answer="19">
                </td>
                <td>
                  <input type="number" class="form-control" name="q17_4" data-answer="33">
                </td>
              </tr>
            </table>
          </p>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            18. A bus company charges a flat fee of R200 plus R1.50 per km. Write the formula for the fare (F).
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_18"
              id="q18_option1"
              value="F = 200d + 1.5"
            />
            <label class="form-check-label" for="q18_option1">F = 200d + 1.5</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_18"
              id="q18_option2"
              value="F = 1.5d + 200"
              correct="true"
            />
            <label class="form-check-label" for="q18_option2">F = 1.5d + 200</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_18"
              id="q18_option3"
              value="F = 1.5 + 200d"
            />
            <label class="form-check-label" for="q18_option3">F = 1.5 + 200d</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            19. If z = (x + 1)², how many black squares in Arrangement 4?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_19"
              id="q19_option1"
              value="16"
            />
            <label class="form-check-label" for="q19_option1">16</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_19"
              id="q19_option2"
              value="25"
              correct="true"
            />
            <label class="form-check-label" for="q19_option2">25</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_19"
              id="q19_option3"
              value="36"
            />
            <label class="form-check-label" for="q19_option3">36</label>
          </div>
        </div>
      </div>

      <div class="card mb-3 question">
        <div class="card-body">
          <p class="card-text">
            20. Pattern: 8 red in Arrangement 1, increases by 3. Formula?
          </p>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_20"
              id="q20_option1"
              value="y = 3x + 5"
              correct="true"
            />
            <label class="form-check-label" for="q20_option1">y = 3x + 5</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_20"
              id="q20_option2"
              value="y = 5x + 3"
            />
            <label class="form-check-label" for="q20_option2">y = 5x + 3</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="question_20"
              id="q20_option3"
              value="y = 3x + 8"
            />
            <label class="form-check-label" for="q20_option3">y = 3x + 8</label>
          </div>
        </div>
      </div>
    </div>
    <div id="results" class="mt-4"></div>
    <button type="button" id="check-answers-btn" class="btn btn-primary">Check Answers</button>
    <button type="submit" id="submit-btn" class="btn btn-success" style="display:none;">Submit Exam</button>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('exam-form');
    const timerDisplay = document.getElementById('timer');
    const durationMinutes = {{ exam.duration_minutes }};
    let timeRemaining = durationMinutes * 60; // in seconds
    let timerInterval;

    function updateTimer() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        timerDisplay.textContent = `Time Left: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        if (timeRemaining <= 0) {
            clearInterval(timerInterval);
            alert('Time is up! Your exam will be submitted automatically.');
            submitExam();
        } else {
            timeRemaining--;
        }
    }

    function submitExam() {
        // Create a hidden input to indicate auto-submission
        const autoSubmitInput = document.createElement('input');
        autoSubmitInput.type = 'hidden';
        autoSubmitInput.name = 'auto_submit';
        autoSubmitInput.value = 'true';
        form.appendChild(autoSubmitInput);
        form.submit();
    }

    // Start the timer when the page loads
    timerInterval = setInterval(updateTimer, 1000);

    // Warn user before navigating away
    window.addEventListener('beforeunload', function (e) {
        // Only warn if the exam hasn't been submitted yet
        if (form.dataset.submitted !== 'true') {
            const confirmationMessage = 'Navigating away from this page will automatically submit and grade your exam. Are you sure you want to leave?';
            (e || window.event).returnValue = confirmationMessage; // Standard for most browsers
            return confirmationMessage; // For some older browsers
        }
    });

    // Auto-submit if user navigates away
    window.addEventListener('unload', function () {
        if (form.dataset.submitted !== 'true') {
            // This will only work if the browser allows synchronous XHR on unload,
            // which is generally deprecated. A better approach is to rely on
            // the server-side to handle incomplete exams or use Beacon API.
            // For this exercise, we'll assume a simple form submission is sufficient
            // if the user confirms leaving.
            // However, the primary mechanism for auto-submission will be the timer.
            // The beforeunload warning is the main deterrent for accidental navigation.
            // For actual submission on unload, a small fetch request might be more reliable
            // but is outside the scope of simple form submission.
            // For now, we'll just ensure the timer handles the auto-submit.
        }
    });

    // Mark form as submitted when the submit button is clicked
    form.addEventListener('submit', function() {
        form.dataset.submitted = 'true';
        clearInterval(timerInterval); // Stop the timer on manual submission
    });
});
</script>
{% endblock %}