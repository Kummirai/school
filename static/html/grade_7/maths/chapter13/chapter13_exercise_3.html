<!-- Bootstrap CSS -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<!-- Google Fonts - Inter -->
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
  rel="stylesheet"
/>
<style>
  .container {
    max-width: 900px;
    background-color: #ffffff;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    padding: 30px;
  }
  h1,
  h2 {
    color: #343a40;
    margin-bottom: 25px;
    font-weight: 600;
  }
  .exercise-section {
    margin-bottom: 40px;
    padding: 25px;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    background-color: #fefefe;
  }
  .question-group {
    margin-bottom: 20px;
    padding: 15px;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    background-color: #ffffff;
  }
  .question-group label {
    font-weight: 500;
    margin-bottom: 8px;
    color: #495057;
  }
  .form-control {
    border-radius: 8px;
    padding: 10px 15px;
    border-color: #ced4da;
  }
  .form-control:focus {
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    border-color: #86b7fe;
  }
  .btn-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
    border-radius: 10px;
    padding: 10px 25px;
    font-weight: 600;
    transition: background-color 0.3s ease, border-color 0.3s ease,
      transform 0.2s ease;
  }
  .btn-primary:hover {
    background-color: #0b5ed7;
    border-color: #0a58ca;
    transform: translateY(-2px);
  }
  .feedback-message {
    margin-top: 15px;
    padding: 10px 15px;
    border-radius: 8px;
    font-weight: 500;
  }
  .feedback-correct {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }
  .feedback-incorrect {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }
  .feedback-partial {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeeba;
  }
  .correct-answer {
    color: green;
    font-weight: bold;
  }
  .incorrect-answer {
    color: red;
    font-weight: bold;
  }
  .table th,
  .table td {
    vertical-align: middle;
  }
</style>

<div class="container">
  <h1 class="text-center mb-5">Algebra Practice Exercises</h1>

  <!-- Exercise 3 -->
  <div id="exercise3" class="exercise-section">
    <h2>Exercise 3: Solving Equations</h2>
    <p>
      Solve each equation for the unknown variable. You can use either the
      method of solving by inspection (guessing and testing) or inverse
      operations (the "over the rainbow" rule). Always state your final answer
      with the "therefore" symbol (âˆ´).
    </p>
    <div class="row">
      <!-- Question 1 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q1">1. <code>x - 8 = 8</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q1"
            placeholder="e.g., x = 16"
          />
        </div>
      </div>
      <!-- Question 2 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q2">2. <code>x + 7 = 20</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q2"
            placeholder="e.g., x = 13"
          />
        </div>
      </div>
      <!-- Question 3 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q3">3. <code>16 / x = 8</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q3"
            placeholder="e.g., x = 2"
          />
        </div>
      </div>
      <!-- Question 4 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q4">4. <code>x / 16 = 2</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q4"
            placeholder="e.g., x = 32"
          />
        </div>
      </div>
      <!-- Question 5 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q5">5. <code>5x = 40</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q5"
            placeholder="e.g., x = 8"
          />
        </div>
      </div>
      <!-- Question 6 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q6">6. <code>x + 3 = 13</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q6"
            placeholder="e.g., x = 10"
          />
        </div>
      </div>
      <!-- Question 7 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q7">7. <code>a - 15 = 22</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q7"
            placeholder="e.g., a = 37"
          />
        </div>
      </div>
      <!-- Question 8 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q8">8. <code>3x + 2 = 11</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q8"
            placeholder="e.g., x = 3"
          />
        </div>
      </div>
      <!-- Question 9 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q9">9. <code>9c + 1 = 10</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q9"
            placeholder="e.g., c = 1"
          />
        </div>
      </div>
      <!-- Question 10 -->
      <div class="col-md-6 mb-3">
        <div class="question-group">
          <label for="e3q10">10. <code>m / 5 = 2</code></label>
          <input
            type="text"
            class="form-control"
            id="e3q10"
            placeholder="e.g., m = 10"
          />
        </div>
      </div>
    </div>
    <button
      type="button"
      class="btn btn-primary mt-3"
      onclick="checkExercise3()"
    >
      Check Answers
    </button>
    <div id="feedback3" class="feedback-message mt-3 d-none"></div>
  </div>
</div>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Helper function to normalize string input for comparison
  function normalizeString(str) {
    if (typeof str !== "string") return "";
    return str.toLowerCase().replace(/\s/g, "").replace(/\*\*/g, "^"); // Normalize spaces and ** to ^ for exponents
  }

  // Helper function to compare numerical values, handling fractions
  function compareNumbers(input, correct) {
    input = String(input).trim();
    correct = String(correct).trim();

    // Handle fractions (e.g., "1/2", "3/4")
    const parseFraction = (s) => {
      const parts = s.split("/");
      if (parts.length === 2) {
        const num = parseFloat(parts[0]);
        const den = parseFloat(parts[1]);
        return den !== 0 ? num / den : NaN;
      }
      return parseFloat(s);
    };

    const parsedInput = parseFraction(input);
    const parsedCorrect = parseFraction(correct);

    // Use a small epsilon for floating point comparisons
    return Math.abs(parsedInput - parsedCorrect) < 1e-9;
  }

  // Function to display feedback
  function displayFeedback(feedbackId, message, type) {
    const feedbackDiv = document.getElementById(feedbackId);
    feedbackDiv.innerHTML = message;
    feedbackDiv.classList.remove(
      "d-none",
      "feedback-correct",
      "feedback-incorrect",
      "feedback-partial"
    );
    feedbackDiv.classList.add(`feedback-${type}`);
  }

  // Exercise 3: Solving Equations
  const correctAnswersE3 = {
    q1: ["x=16", "16"],
    q2: ["x=13", "13"],
    q3: ["x=2", "2"],
    q4: ["x=32", "32"],
    q5: ["x=8", "8"],
    q6: ["x=10", "10"],
    q7: ["a=37", "37"],
    q8: ["x=3", "3"],
    q9: ["c=1", "1"],
    q10: ["m=10", "10"],
  };

  function checkExercise3() {
    let score = 0;
    const totalQuestions = Object.keys(correctAnswersE3).length;
    let feedbackHtml = "";

    for (let i = 1; i <= totalQuestions; i++) {
      const qId = `q${i}`;
      const inputElement = document.getElementById(`e3${qId}`);
      const userAnswer = normalizeString(inputElement.value);
      const correctOptions = correctAnswersE3[qId].map(normalizeString);

      let isCorrect = correctOptions.includes(userAnswer);

      feedbackHtml += `<strong>Question ${i}:</strong> `;
      if (isCorrect) {
        score++;
        feedbackHtml += `<span class="correct-answer">${inputElement.value} (Correct)</span><br>`;
        inputElement.classList.remove("is-invalid");
        inputElement.classList.add("is-valid");
      } else {
        feedbackHtml += `<span class="incorrect-answer">${
          inputElement.value
        } (Incorrect, Correct options: ${correctAnswersE3[qId].join(
          " or "
        )})</span><br>`;
        inputElement.classList.remove("is-valid");
        inputElement.classList.add("is-invalid");
      }
    }

    const percentage = (score / totalQuestions) * 100;
    let feedbackType = "incorrect";
    if (score === totalQuestions) {
      feedbackType = "correct";
    } else if (score > 0) {
      feedbackType = "partial";
    }

    const finalMessage = `You scored ${score} out of ${totalQuestions} (${percentage.toFixed(
      2
    )}%).<br><br>${feedbackHtml}`;
    displayFeedback("feedback3", finalMessage, feedbackType);
  }
</script>
